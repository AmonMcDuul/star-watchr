@if (location.selected() == null) {
  <div class="empty-state">
    <div class="empty-card">
      <h3>Select a location</h3>
      <p>Choose a location to see available Messier objects</p>
      <app-location-search></app-location-search>
    </div>
  </div>
}
@else {

  <div class="time">
    <h2>{{ time.dateTime() | date:'EEEE MMM dd yyyy HH:mm' }}</h2>
  </div>

  <div class="matrix-controls-row">
    <div class="matrix-controls">
      <button (click)="time.shift(-1)">◀</button>
      <button (click)="time.reset()">Now</button>
      <button (click)="time.shift(1)">▶</button>
    </div>

    <div class="matrix-controls">
      <button (click)="time.shiftDays(1)" [class.active]="isActiveDay(1)">{{ dayPlus(1) }}</button>
      <button (click)="time.shiftDays(2)" [class.active]="isActiveDay(2)">{{ dayPlus(2) }}</button>
      <button (click)="time.shiftDays(3)" [class.active]="isActiveDay(3)">{{ dayPlus(3) }}</button>
      <button (click)="time.shiftDays(4)" [class.active]="isActiveDay(4)">{{ dayPlus(4) }}</button>
      <button (click)="time.shiftDays(5)" [class.active]="isActiveDay(5)">{{ dayPlus(5) }}</button>
    </div>
  </div>

  <div class="filter-bar">
    <details class="filter-dropdown">
      <summary>Filters</summary>

      <div class="filter-panel">

        <div class="filter-group">
          <span>Difficulty</span>
          <button (click)="setDifficulty(null)" [class.active]="messier.difficultyFilter() === null">All</button>
          <button (click)="setDifficulty('Very Easy')" [class.active]="messier.difficultyFilter() === 'Very Easy'">Very Easy</button>
          <button (click)="setDifficulty('Easy')" [class.active]="messier.difficultyFilter() === 'Easy'">Easy</button>
          <button (click)="setDifficulty('Moderate')" [class.active]="messier.difficultyFilter() === 'Moderate'">Moderate</button>
          <button (click)="setDifficulty('Hard')" [class.active]="messier.difficultyFilter() === 'Hard'">Hard</button>
          <button (click)="setDifficulty('Very Hard')" [class.active]="messier.difficultyFilter() === 'Very Hard'">Very Hard</button>
        </div>

        <div class="filter-group">
          <span>Season</span>
          <button (click)="setSeason(null)" [class.active]="messier.seasonFilter() === null">All</button>
          <button (click)="setSeason('Winter')" [class.active]="messier.seasonFilter() === 'Winter'">Winter</button>
          <button (click)="setSeason('Spring')" [class.active]="messier.seasonFilter() === 'Spring'">Spring</button>
          <button (click)="setSeason('Summer')" [class.active]="messier.seasonFilter() === 'Summer'">Summer</button>
          <button (click)="setSeason('Autumn')" [class.active]="messier.seasonFilter() === 'Autumn'">Autumn</button>
        </div>

        <div class="filter-group">
          <span>Constellation</span>
          <button (click)="setConstellation(null)" [class.active]="messier.constellationFilter() === null">All</button>
          @for (c of messier.availableConstellations(); track c) {
            <button (click)="setConstellation(c)" [class.active]="messier.constellationFilter() === c">{{ c }}</button>
          }
        </div>

        <div class="filter-group">
          <button class="clear-btn" (click)="clearFilters()">Clear filters</button>
        </div>

      </div>
    </details>
  </div>

  <div class="map-size-controls">
    <button (click)="mapSize = 'compact'" [class.active]="mapSize === 'compact'">Compact</button>
    <button (click)="mapSize = 'normal'" [class.active]="mapSize === 'normal'">Normal</button>
    <button (click)="mapSize = 'large'" [class.active]="mapSize === 'large'">Large</button>
  </div>

  <div class="grid-wrapper"
       [class.compact]="mapSize === 'compact'"
       [class.normal]="mapSize === 'normal'"
       [class.large]="mapSize === 'large'">

    @if (messier.loading()) {
      <p class="muted">Messier-objecten laden…</p>
    }

    @if (!messier.loading()) {
      <div class="messier-grid">
        @for (m of messier.visible(); track m.messierNumber) {
          <article class="messier-card"
                   [class.active]="selected() === m.messierNumber"
                   (click)="select(m.messierNumber)">

            <img [src]="m.image" [alt]="m.name" />

            <div class="info">
              <strong>M{{ m.messierNumber }} – {{ m.name }}</strong>
              <span>{{ m.type }}</span>
              <span>Mag {{ m.magnitude }}</span>
              <span>{{ m.constellation }}</span>
            </div>

            @if (selected() === m.messierNumber) {
              <div class="details">
                <div>NGC: {{ m.NGC }}</div>
                <div>Type: {{ m.type }}</div>
                <div>Distance: {{ m.distance }} ly</div>
                <div>Size: {{ m.size }}</div>
                <div>Difficulty: {{ m.viewingDifficulty }}</div>
                <div>Altitude: {{ m.altitude | number:'1.0-0' }}°</div>

                <button class="starhop-btn"
                        (click)="goToDso(m); $event.stopPropagation()">
                  Open details
                </button>
              </div>
            }
          </article>
        }
      </div>
    }
  </div>
}
<br><br><br><br>