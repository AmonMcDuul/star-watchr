<div class="matrix-legend"
        [class.mode-standard]="ui.colorMode() === 'standard'"
        [class.mode-deuteranopia]="ui.colorMode() === 'deuteranopia'"
        [class.mode-protanopia]="ui.colorMode() === 'protanopia'"
        [class.mode-tritanopia]="ui.colorMode() === 'tritanopia'">
  <h2>Legend</h2>

  <div class="legend-columns">

    <div class="legend-column legend-left">
      <div class="legend-left-sections">

        <!-- Cloud -->
        <div class="legend-section">
          <h3>Cloud</h3>
          <div class="legend-column-items">
            <div class="legend-item"><span class="dot cloud c9"></span><span>Overcast (9/9)</span></div>
            <div class="legend-item"><span class="dot cloud c8"></span><span>8/9</span></div>
            <div class="legend-item"><span class="dot cloud c7"></span><span>7/9</span></div>
            <div class="legend-item"><span class="dot cloud c6"></span><span>6/9</span></div>
            <div class="legend-item"><span class="dot cloud c5"></span><span>5/9</span></div>
            <div class="legend-item"><span class="dot cloud c4"></span><span>4/9</span></div>
            <div class="legend-item"><span class="dot cloud c3"></span><span>3/9</span></div>
            <div class="legend-item"><span class="dot cloud c2"></span><span>2/9</span></div>
            <div class="legend-item"><span class="dot cloud c1"></span><span>Clear (1/9)</span></div>
          </div>
        </div>

        <!-- Seeing -->
        <div class="legend-section">
          <h3>Seeing</h3>
          <div class="legend-column-items">
            <div class="legend-item"><span class="dot seeing s1"></span><span>Very Poor (1/8)</span></div>
            <div class="legend-item"><span class="dot seeing s2"></span><span>2/8</span></div>
            <div class="legend-item"><span class="dot seeing s3"></span><span>3/8</span></div>
            <div class="legend-item"><span class="dot seeing s4"></span><span>4/8</span></div>
            <div class="legend-item"><span class="dot seeing s5"></span><span>5/8</span></div>
            <div class="legend-item"><span class="dot seeing s6"></span><span>6/8</span></div>
            <div class="legend-item"><span class="dot seeing s7"></span><span>7/8</span></div>
            <div class="legend-item"><span class="dot seeing s8"></span><span>Excellent 8/8</span></div>
          </div>
        </div>

      </div>
    </div>

    <div class="legend-column legend-right">

      <!-- Transparency -->
      <div class="legend-section">
        <h3>Transparency</h3>
        <div class="legend-row">
          <div class="legend-item"><span class="bar trans t2"></span><span>Low</span></div>
          <div class="legend-item"><span class="bar trans t6"></span><span>Medium</span></div>
          <div class="legend-item"><span class="bar trans t9"></span><span>High</span></div>
        </div>
      </div>

      <!-- Astronomical Night -->
      <div class="legend-section">
        <h3>Darkness</h3>
        <div class="legend-row">
          <div class="legend-item"><span class="cell astro-night"></span><span>Full darkness</span></div>
          <div class="legend-item"><span class="cell astro-night-partial"></span><span>Partial darkness</span></div>
          <div class="legend-item"><span class="cell no-astro-night"></span><span>No darkness</span></div>
        </div>
      </div>

      <!-- Moon -->
      <div class="legend-section">
        <h3>Moon</h3>
        <div class="legend-row">
          <div class="legend-item">
            <img
              class="moon-icon"
              [src]="'assets/img/nomoon.png'"
              alt="No moon"
            />
           <span>Moon is under horizon</span></div>
        </div>
          <div class="legend-item">
            <img
              class="moon-icon"
              [src]="'assets/img/' + context.moonPhaseLabel() + '.png'"
              alt="Moon phase"
            />
           <span>Moon is above horizon</span></div>
      </div>
    </div>
  </div>

  <!-- Explanation -->
  <div class="legend-explanation">

    <button
      class="legend-toggle"
      (click)="toggleCalculationInfo()"
      [attr.aria-expanded]="showCalculationInfo"
      aria-controls="legend-calc-content">

      How the values are calculated
      <span class="chevron" [class.open]="showCalculationInfo"></span>
    </button>

    <div
      id="legend-calc-content"
      class="legend-calc-content"
      *ngIf="showCalculationInfo">

      <!-- <h4>Total cloud</h4>
      <p>
        Total cloud cover represents the forecasted total percentage of the sky that is
        covered by clouds, as provided by the weather model.
        It includes all cloud layers (low, mid, and high) and reflects the
        meteorological definition of cloudiness rather than visual sky clarity.
      </p>

      <h4>Cloud score</h4>
      <p>
        Normalised cloud cover is an astronomy-optimized interpretation of cloud cover.
        It is calculated by weighting low, mid, and high cloud layers differently,
        giving the most importance to low-level clouds and the least to high-level
        clouds such as thin cirrus.
        This provides a more realistic estimate of how clouds affect astronomical
        observing conditions.
      </p> -->

      <h4>Seeing</h4>
      <p>
        Seeing estimates how stable the atmosphere is for astronomical observing.
        It is calculated using surface wind speed, atmospheric pressure, temperature
        gradients in the atmosphere, and high-altitude wind (jet stream) data when available.
      </p>

      <h4>Transparency</h4>
      <p>
        Transparency estimates how clear and light-transparent the atmosphere is.
        It is derived from forecasted visibility, relative humidity, and the amount
        of high-level cloud cover, which can reduce sky clarity even without thick clouds.
      </p>

      <!-- <h4>Overall score</h4>
      <p>
        The overall score combines cloud cover, seeing, and transparency into a single
        value that represents the overall suitability for astronomical observation at
        a given time.
      </p> -->

    </div>
  </div>

</div>